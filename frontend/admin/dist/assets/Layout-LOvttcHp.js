import{y as ne,r as _,l as re,c as R,aC as de,h as ue,U as ie,z as V,R as e,J as o,al as s,Q as me,B as v,I as f,u as l,O as u,L as F,P as q,T as ce,aB as fe,A as i,M as _e}from"./vendor-Dt6xM8n7.js";import{m as A,o as pe,s as we,d as ge,u as z,c as ve,e as be,f as he,r as Pe,g as ye,h as xe,j as ke,l as Ce,k as Ve,b,n as Fe}from"./elementPlus-DUIuSOAC.js";import{u as ze}from"./index-CSI0wDto.js";import{a as Ee}from"./index-BIipHNwb.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ue={class:"sidebar-header"},Le={key:0,class:"logo"},Me={class:"header-left"},Se={class:"header-right"},Te={class:"user-info"},Re={key:0,class:"username"},qe=ne({__name:"Layout",setup(Ae){const E=de(),B=fe(),h=ze(),m=_(!1),p=_(!1),w=_(!1),y=_(!1),P=_(),D=_(""),d=re({oldPassword:"",newPassword:"",confirmPassword:""}),I={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(n,a,t)=>{a!==d.newPassword?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]},N=R(()=>E.path),U=R(()=>({"/dashboard":"数据概览","/dashboard/wheelchairs":"轮椅管理","/dashboard/orders":"订单管理","/dashboard/users":"用户管理","/dashboard/settings":"系统设置"})[E.path]||""),j=()=>{m.value=!m.value,localStorage.setItem("sidebar_collapsed",String(m.value))},O=()=>{window.location.reload()},J=()=>{document.fullscreenElement?(document.exitFullscreen(),p.value=!1):(document.documentElement.requestFullscreen(),p.value=!0)},L=()=>{p.value=!!document.fullscreenElement},Q=n=>{switch(n){case"profile":b.info("个人资料功能开发中");break;case"changePassword":w.value=!0;break;case"logout":$();break}},$=async()=>{try{await Fe.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),h.logout(),b.success("已退出登录"),B.push("/login")}catch{}},G=async()=>{var n,a;if(P.value)try{if(!await P.value.validate())return;y.value=!0;const c=await Ee.changePassword({oldPassword:d.oldPassword,newPassword:d.newPassword});c.code===200?(b.success("密码修改成功，请重新登录"),w.value=!1,Object.assign(d,{oldPassword:"",newPassword:"",confirmPassword:""}),setTimeout(()=>{h.logout(),B.push("/login")},1e3)):b.error(c.message||"密码修改失败")}catch(t){console.error("修改密码失败:",t),b.error(((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.message)||"密码修改失败")}finally{y.value=!1}},H=()=>{var n;(n=P.value)==null||n.resetFields(),Object.assign(d,{oldPassword:"",newPassword:"",confirmPassword:""})};return ue(()=>{const n=localStorage.getItem("sidebar_collapsed");n&&(m.value=n==="true"),h.initUser(),document.addEventListener("fullscreenchange",L)}),ie(()=>{document.removeEventListener("fullscreenchange",L)}),(n,a)=>{const t=s("el-icon"),c=s("el-menu-item"),K=s("el-menu"),W=s("el-aside"),g=s("el-button"),M=s("el-breadcrumb-item"),X=s("el-breadcrumb"),S=s("el-tooltip"),Y=s("el-avatar"),x=s("el-dropdown-item"),Z=s("el-dropdown-menu"),ee=s("el-dropdown"),oe=s("el-header"),ae=s("router-view"),te=s("el-main"),T=s("el-container"),k=s("el-input"),C=s("el-form-item"),se=s("el-form"),le=s("el-dialog");return i(),V(me,null,[e(T,{class:"layout-container"},{default:o(()=>[e(W,{width:m.value?"64px":"240px",class:"sidebar"},{default:o(()=>[v("div",Ue,[m.value?(i(),f(t,{key:1,size:"32",color:"#409EFF"},{default:o(()=>[e(l(A))]),_:1})):(i(),V("div",Le,[e(t,{size:"32",color:"#409EFF"},{default:o(()=>[e(l(A))]),_:1}),a[5]||(a[5]=v("span",{class:"logo-text"},"轮椅租赁",-1))]))]),e(K,{"default-active":N.value,collapse:m.value,"unique-opened":!0,router:"",class:"sidebar-menu"},{default:o(()=>[e(c,{index:"/dashboard"},{title:o(()=>[...a[6]||(a[6]=[u("数据概览",-1)])]),default:o(()=>[e(t,null,{default:o(()=>[e(l(pe))]),_:1})]),_:1}),e(c,{index:"/dashboard/wheelchairs"},{title:o(()=>[...a[7]||(a[7]=[u("轮椅管理",-1)])]),default:o(()=>[e(t,null,{default:o(()=>[e(l(we))]),_:1})]),_:1}),e(c,{index:"/dashboard/orders"},{title:o(()=>[...a[8]||(a[8]=[u("订单管理",-1)])]),default:o(()=>[e(t,null,{default:o(()=>[e(l(ge))]),_:1})]),_:1}),e(c,{index:"/dashboard/users"},{title:o(()=>[...a[9]||(a[9]=[u("用户管理",-1)])]),default:o(()=>[e(t,null,{default:o(()=>[e(l(z))]),_:1})]),_:1}),e(c,{index:"/dashboard/settings"},{title:o(()=>[...a[10]||(a[10]=[u("系统设置",-1)])]),default:o(()=>[e(t,null,{default:o(()=>[e(l(ve))]),_:1})]),_:1})]),_:1},8,["default-active","collapse"])]),_:1},8,["width"]),e(T,null,{default:o(()=>[e(oe,{class:"header"},{default:o(()=>[v("div",Me,[e(g,{type:"text",size:"large",onClick:j},{default:o(()=>[e(t,{size:"20"},{default:o(()=>[m.value?(i(),f(l(be),{key:0})):(i(),f(l(he),{key:1}))]),_:1})]),_:1}),e(X,{separator:"/",class:"breadcrumb"},{default:o(()=>[e(M,{to:{path:"/dashboard"}},{default:o(()=>[...a[11]||(a[11]=[u("首页",-1)])]),_:1}),U.value?(i(),f(M,{key:0},{default:o(()=>[u(q(U.value),1)]),_:1})):F("",!0)]),_:1})]),v("div",Se,[e(S,{content:"刷新页面",placement:"bottom"},{default:o(()=>[e(g,{type:"text",size:"large",onClick:O},{default:o(()=>[e(t,{size:"18"},{default:o(()=>[e(l(Pe))]),_:1})]),_:1})]),_:1}),e(S,{content:p.value?"退出全屏":"全屏",placement:"bottom"},{default:o(()=>[e(g,{type:"text",size:"large",onClick:J},{default:o(()=>[e(t,{size:"18"},{default:o(()=>[p.value?(i(),f(l(xe),{key:1})):(i(),f(l(ye),{key:0}))]),_:1})]),_:1})]),_:1},8,["content"]),e(ee,{onCommand:Q},{dropdown:o(()=>[e(Z,null,{default:o(()=>[e(x,{command:"profile"},{default:o(()=>[e(t,null,{default:o(()=>[e(l(z))]),_:1}),a[12]||(a[12]=u(" 个人资料 ",-1))]),_:1}),e(x,{command:"changePassword"},{default:o(()=>[e(t,null,{default:o(()=>[e(l(Ce))]),_:1}),a[13]||(a[13]=u(" 修改密码 ",-1))]),_:1}),e(x,{divided:"",command:"logout"},{default:o(()=>[e(t,null,{default:o(()=>[e(l(Ve))]),_:1}),a[14]||(a[14]=u(" 退出登录 ",-1))]),_:1})]),_:1})]),default:o(()=>{var r;return[v("div",Te,[e(Y,{size:32,src:D.value},{default:o(()=>[e(t,null,{default:o(()=>[e(l(z))]),_:1})]),_:1},8,["src"]),m.value?F("",!0):(i(),V("span",Re,q(((r=l(h).user)==null?void 0:r.username)||"管理员"),1)),m.value?F("",!0):(i(),f(t,{key:1,size:"12"},{default:o(()=>[e(l(ke))]),_:1}))])]}),_:1})])]),_:1}),e(te,{class:"main-content"},{default:o(()=>[e(ae,null,{default:o(({Component:r})=>[e(ce,{name:"fade-transform",mode:"out-in"},{default:o(()=>[(i(),f(_e(r)))]),_:2},1024)]),_:1})]),_:1})]),_:1})]),_:1}),e(le,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=r=>w.value=r),title:"修改密码",width:"400px","before-close":H},{footer:o(()=>[e(g,{onClick:a[3]||(a[3]=r=>w.value=!1)},{default:o(()=>[...a[15]||(a[15]=[u("取消",-1)])]),_:1}),e(g,{type:"primary",loading:y.value,onClick:G},{default:o(()=>[...a[16]||(a[16]=[u(" 确认修改 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[e(se,{ref_key:"passwordFormRef",ref:P,model:d,rules:I,"label-width":"80px"},{default:o(()=>[e(C,{label:"原密码",prop:"oldPassword"},{default:o(()=>[e(k,{modelValue:d.oldPassword,"onUpdate:modelValue":a[0]||(a[0]=r=>d.oldPassword=r),type:"password","show-password":"",placeholder:"请输入原密码"},null,8,["modelValue"])]),_:1}),e(C,{label:"新密码",prop:"newPassword"},{default:o(()=>[e(k,{modelValue:d.newPassword,"onUpdate:modelValue":a[1]||(a[1]=r=>d.newPassword=r),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),e(C,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[e(k,{modelValue:d.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=r=>d.confirmPassword=r),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Je=Be(qe,[["__scopeId","data-v-43746d4c"]]);export{Je as default};
