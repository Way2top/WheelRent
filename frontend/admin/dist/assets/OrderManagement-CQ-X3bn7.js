import{y as ie,r as p,l as P,h as _e,z as F,R as e,J as t,al as d,B as c,K as pe,a4 as ce,u as h,O as s,ar as me,I as T,P as r,L as U,A as C}from"./vendor-Dt6xM8n7.js";import{b as v,q as K,r as fe,v as ve,t as ge,y as ye,z as be,n as he}from"./elementPlus-DUIuSOAC.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce={class:"order-management"},Ve={class:"card-header"},ke={class:"table-toolbar"},xe={class:"search-form"},De={class:"user-info"},ze={class:"user-name"},Se={class:"user-phone"},Me={class:"price"},Te={class:"pagination-container"},Ue={key:0,class:"order-detail"},Re={class:"price"},Be=ie({__name:"OrderManagement",setup(Ye){const k=p(!1),x=p(!1),D=p(!1),w=p(!1),z=p(),R=p([]),u=p(null),B=p(null),Y=p(0),S=p(null),n=P({page:1,limit:20,keyword:"",status:"",start_date:"",end_date:""}),g=P({status:"待配送",notes:""}),j={status:[{required:!0,message:"请选择订单状态",trigger:"change"}]},O=o=>({待配送:"warning",已配送:"primary",使用中:"success",已归还:"info",已取消:"danger"})[o]||"info",V=o=>new Date(o).toLocaleString("zh-CN"),q=o=>!["已归还","已取消"].includes(o),A=o=>["待配送","已配送"].includes(o),J=o=>{o?(n.start_date=o[0],n.end_date=o[1]):(n.start_date="",n.end_date="")},y=async()=>{try{k.value=!0;const o={items:[{id:1,order_no:"WR20240115001",user_name:"张三",user_phone:"13800138001",user_address:"北京市朝阳区某某街道123号",wheelchair_id:1,wheelchair_name:"标准轮椅 SW-001",deposit:50,status:"使用中",create_time:"2024-01-15T10:30:00Z",delivery_time:"2024-01-15T14:30:00Z",return_time:null,notes:"用户要求下午配送"},{id:2,order_no:"WR20240115002",user_name:"李四",user_phone:"13800138002",user_address:"上海市浦东新区某某路456号",wheelchair_id:2,wheelchair_name:"电动轮椅 EW-002",deposit:120,status:"待配送",create_time:"2024-01-15T11:00:00Z",delivery_time:null,return_time:null,notes:null},{id:3,order_no:"WR20240114003",user_name:"王五",user_phone:"13800138003",user_address:"广州市天河区某某大道789号",wheelchair_id:1,wheelchair_name:"标准轮椅 SW-001",deposit:50,status:"已归还",create_time:"2024-01-14T09:00:00Z",delivery_time:"2024-01-14T13:00:00Z",return_time:"2024-01-15T09:00:00Z",notes:"按时归还，轮椅状态良好"}],total:3,page:1,limit:20,totalPages:1};R.value=o.items,Y.value=o.total}catch(o){console.error("获取订单列表失败:",o),v.error("获取数据失败，请稍后重试")}finally{k.value=!1}},W=()=>{n.page=1,y()},G=()=>{Object.assign(n,{page:1,limit:20,keyword:"",status:"",start_date:"",end_date:""}),S.value=null,y()},H=async()=>{try{v.info("导出功能开发中...")}catch(o){console.error("导出失败:",o),v.error("导出失败，请稍后重试")}},Q=o=>{n.limit=o,n.page=1,y()},X=o=>{n.page=o,y()},Z=async o=>{try{u.value=o,D.value=!0}catch(l){console.error("获取订单详情失败:",l),v.error("获取订单详情失败")}},ee=o=>{B.value=o.id,g.status=o.status,g.notes="",w.value=!0},te=async o=>{try{await he.confirm(`确定要取消订单"${o.order_no}"吗？`,"取消订单确认",{confirmButtonText:"确定取消",cancelButtonText:"取消",type:"warning"}),v.success("订单已取消"),y()}catch(l){l!=="cancel"&&(console.error("取消订单失败:",l),v.error("取消订单失败，请稍后重试"))}},le=async()=>{if(!(!z.value||!B.value))try{if(!await z.value.validate())return;x.value=!0,v.success("状态更新成功"),w.value=!1,y()}catch(o){console.error("状态更新失败:",o),v.error("状态更新失败，请稍后重试")}finally{x.value=!1}};return _e(()=>{y()}),(o,l)=>{const b=d("el-icon"),m=d("el-button"),$=d("el-input"),_=d("el-option"),E=d("el-select"),ae=d("el-date-picker"),f=d("el-table-column"),N=d("el-tag"),oe=d("el-table"),se=d("el-pagination"),ne=d("el-card"),i=d("el-descriptions-item"),re=d("el-descriptions"),I=d("el-dialog"),L=d("el-form-item"),ue=d("el-form"),de=me("loading");return C(),F("div",Ce,[e(ne,null,{header:t(()=>[c("div",Ve,[l[11]||(l[11]=c("span",null,"订单管理",-1)),e(m,{type:"primary",onClick:H},{default:t(()=>[e(b,null,{default:t(()=>[e(h(be))]),_:1}),l[10]||(l[10]=s(" 导出订单 ",-1))]),_:1})])]),default:t(()=>[c("div",ke,[c("div",xe,[e($,{modelValue:n.keyword,"onUpdate:modelValue":l[0]||(l[0]=a=>n.keyword=a),placeholder:"搜索订单号或用户姓名",style:{width:"240px"},clearable:"",onKeyup:ce(W,["enter"])},{prefix:t(()=>[e(b,null,{default:t(()=>[e(h(K))]),_:1})]),_:1},8,["modelValue"]),e(E,{modelValue:n.status,"onUpdate:modelValue":l[1]||(l[1]=a=>n.status=a),placeholder:"状态筛选",style:{width:"120px"},clearable:""},{default:t(()=>[e(_,{label:"待配送",value:"待配送"}),e(_,{label:"已配送",value:"已配送"}),e(_,{label:"使用中",value:"使用中"}),e(_,{label:"已归还",value:"已归还"}),e(_,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"]),e(ae,{modelValue:S.value,"onUpdate:modelValue":l[2]||(l[2]=a=>S.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:J},null,8,["modelValue"]),e(m,{type:"primary",onClick:W},{default:t(()=>[e(b,null,{default:t(()=>[e(h(K))]),_:1}),l[12]||(l[12]=s(" 搜索 ",-1))]),_:1}),e(m,{onClick:G},{default:t(()=>[e(b,null,{default:t(()=>[e(h(fe))]),_:1}),l[13]||(l[13]=s(" 重置 ",-1))]),_:1})])]),pe((C(),T(oe,{data:R.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(f,{prop:"id",label:"ID",width:"80"}),e(f,{prop:"order_no",label:"订单号",width:"180"},{default:t(({row:a})=>[e(m,{type:"text",onClick:M=>Z(a)},{default:t(()=>[s(r(a.order_no),1)]),_:2},1032,["onClick"])]),_:1}),e(f,{label:"用户信息","min-width":"150"},{default:t(({row:a})=>[c("div",De,[c("div",ze,r(a.user_name),1),c("div",Se,r(a.user_phone),1)])]),_:1}),e(f,{prop:"wheelchair_name",label:"轮椅","min-width":"120"}),e(f,{prop:"deposit",label:"定金",width:"100"},{default:t(({row:a})=>[c("span",Me,"¥"+r(a.deposit),1)]),_:1}),e(f,{prop:"status",label:"状态",width:"100"},{default:t(({row:a})=>[e(N,{type:O(a.status),size:"small"},{default:t(()=>[s(r(a.status),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"create_time",label:"下单时间",width:"180"},{default:t(({row:a})=>[s(r(V(a.create_time)),1)]),_:1}),e(f,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[e(m,{type:"text",size:"small",onClick:M=>Z(a)},{default:t(()=>[e(b,null,{default:t(()=>[e(h(ve))]),_:1}),l[14]||(l[14]=s(" 详情 ",-1))]),_:1},8,["onClick"]),q(a.status)?(C(),T(m,{key:0,type:"text",size:"small",onClick:M=>ee(a)},{default:t(()=>[e(b,null,{default:t(()=>[e(h(ge))]),_:1}),l[15]||(l[15]=s(" 更新状态 ",-1))]),_:1},8,["onClick"])):U("",!0),A(a.status)?(C(),T(m,{key:1,type:"text",size:"small",style:{color:"#f56c6c"},onClick:M=>te(a)},{default:t(()=>[e(b,null,{default:t(()=>[e(h(ye))]),_:1}),l[16]||(l[16]=s(" 取消 ",-1))]),_:1},8,["onClick"])):U("",!0)]),_:1})]),_:1},8,["data"])),[[de,k.value]]),c("div",Te,[e(se,{"current-page":n.page,"onUpdate:currentPage":l[3]||(l[3]=a=>n.page=a),"page-size":n.limit,"onUpdate:pageSize":l[4]||(l[4]=a=>n.limit=a),total:Y.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),_:1}),e(I,{modelValue:D.value,"onUpdate:modelValue":l[5]||(l[5]=a=>D.value=a),title:"订单详情",width:"800px"},{default:t(()=>[u.value?(C(),F("div",Ue,[e(re,{column:2,border:""},{default:t(()=>[e(i,{label:"订单号"},{default:t(()=>[s(r(u.value.order_no),1)]),_:1}),e(i,{label:"订单状态"},{default:t(()=>[e(N,{type:O(u.value.status)},{default:t(()=>[s(r(u.value.status),1)]),_:1},8,["type"])]),_:1}),e(i,{label:"用户姓名"},{default:t(()=>[s(r(u.value.user_name),1)]),_:1}),e(i,{label:"联系电话"},{default:t(()=>[s(r(u.value.user_phone),1)]),_:1}),e(i,{label:"收货地址",span:2},{default:t(()=>[s(r(u.value.user_address),1)]),_:1}),e(i,{label:"轮椅名称"},{default:t(()=>[s(r(u.value.wheelchair_name),1)]),_:1}),e(i,{label:"定金金额"},{default:t(()=>[c("span",Re,"¥"+r(u.value.deposit),1)]),_:1}),e(i,{label:"下单时间"},{default:t(()=>[s(r(V(u.value.create_time)),1)]),_:1}),e(i,{label:"配送时间"},{default:t(()=>[s(r(u.value.delivery_time?V(u.value.delivery_time):"未配送"),1)]),_:1}),e(i,{label:"归还时间"},{default:t(()=>[s(r(u.value.return_time?V(u.value.return_time):"未归还"),1)]),_:1}),e(i,{label:"备注",span:2},{default:t(()=>[s(r(u.value.notes||"无"),1)]),_:1})]),_:1})])):U("",!0)]),_:1},8,["modelValue"]),e(I,{modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=a=>w.value=a),title:"更新订单状态",width:"400px"},{footer:t(()=>[e(m,{onClick:l[8]||(l[8]=a=>w.value=!1)},{default:t(()=>[...l[17]||(l[17]=[s("取消",-1)])]),_:1}),e(m,{type:"primary",loading:x.value,onClick:le},{default:t(()=>[...l[18]||(l[18]=[s(" 确定更新 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(ue,{ref_key:"statusFormRef",ref:z,model:g,rules:j,"label-width":"80px"},{default:t(()=>[e(L,{label:"新状态",prop:"status"},{default:t(()=>[e(E,{modelValue:g.status,"onUpdate:modelValue":l[6]||(l[6]=a=>g.status=a),style:{width:"100%"}},{default:t(()=>[e(_,{label:"待配送",value:"待配送"}),e(_,{label:"已配送",value:"已配送"}),e(_,{label:"使用中",value:"使用中"}),e(_,{label:"已归还",value:"已归还"}),e(_,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),_:1}),e(L,{label:"备注",prop:"notes"},{default:t(()=>[e($,{modelValue:g.notes,"onUpdate:modelValue":l[7]||(l[7]=a=>g.notes=a),type:"textarea",rows:3,placeholder:"请输入备注信息（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),$e=we(Be,[["__scopeId","data-v-4b3490b9"]]);export{$e as default};
